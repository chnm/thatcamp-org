{"version":3,"sources":["utils.js"],"names":["$","ajaxSetup","cache","click","confirm","post","ajaxurl","action","backupclick","unbind","text","data","color","html","css","cleanautoclick","days","button","prevtext","this","maintclick","do_translate_all","progressbar","value","stop_translate_var","ajax","url","dataType","success","dotimer","a","clearTimeout","timer2","length","translate_post","setTimeout","stop_translate","jQuery"],"mappings":"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","sourcesContent":["/*  Copyright Â© 2009-2018 Transposh Team (website : http://transposh.org)\n *\n *\tThis program is free software; you can redistribute it and/or modify\n *\tit under the terms of the GNU General Public License as published by\n *\tthe Free Software Foundation; either version 2 of the License, or\n *\t(at your option) any later version.\n *\n *\tThis program is distributed in the hope that it will be useful,\n *\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n *\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *\tGNU General Public License for more details.\n *\n *\tYou should have received a copy of the GNU General Public License\n *\talong with this program; if not, write to the Free Software\n *\tFoundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\n */\n\n(function ($) { // closure\n    $(function() {\n        $.ajaxSetup({\n            cache: false\n        });\n\n        $(\"#transposh-reset-options\").click(function() {\n            if (!confirm(\"Are you sure you want to do this?\")) return false;\n            if (!confirm(\"Are you REALLY sure you want to do this, your configuration will be reset?\")) return false;\n            $.post(ajaxurl, {\n                action: 'tp_reset'\n            });\n        });\n\n        // backup button\n        backupclick = function () {\n            $(\"#transposh-backup\").unbind('click').click(function(){\n                return false\n            }).text(\"Backup In Progress\");\n            $.post(ajaxurl, {\n                action: 'tp_backup'\n            },\n            function(data) {\n                var color = 'red';\n                if (data[0] == '2') color = 'green';\n                $('#backup_result').html(data).css('color',color);\n                $(\"#transposh-backup\").unbind('click').click(backupclick).text(\"Do Backup Now\");\n            });\n            return false;\n        };\n        $(\"#transposh-backup\").click(backupclick);\n\n        // cleanup button\n        cleanautoclick = function (days,button) {\n            if (!confirm(\"Are you sure you want to do this?\")) return false;\n            if (days == 0 && !confirm(\"Are you REALLY sure you want to do this?\")) return false;\n            //var button = $(this);\n            //console.log(button);\n            var prevtext = button.text();\n            button.unbind('click').click(function(){\n                return false\n            }).text(\"Cleanup in progress\");\n            $.post(ajaxurl, {\n                action: 'tp_cleanup',\n                days: days\n            },\n            function(data) {\n                button.unbind('click').click(function() {\n                    cleanautoclick(days,button);\n                    return false;\n                }).text(prevtext);\n            });\n            return false;\n        };\n        \n        $(\"#transposh-clean-auto\").click(function() {\n            cleanautoclick(0,$(this));\n            return false;\n        });\n\n        $(\"#transposh-clean-auto14\").click(function() {\n            cleanautoclick(14,$(this));\n            return false;\n        });\n\n        $(\"#transposh-clean-unimportant\").click(function() {\n            cleanautoclick(999,$(this));\n            return false;\n        });\n\n        maintclick = function (button) {\n            if (!confirm(\"Are you sure you want to do this?\")) return false;\n            var prevtext = button.text();\n            button.unbind('click').click(function(){\n                return false\n            }).text(\"Maintenance in progress\");\n            $.post(ajaxurl, {\n                action: 'tp_maint'\n            },\n            function(data) {\n                button.unbind('click').click(function() {\n                    maintclick(button);\n                    return false;\n                }).text(prevtext);\n            });\n            return false;\n        }\n    \n        $(\"#transposh-maint\").click(function() {\n            maintclick($(this));\n            return false;\n        });\n\n//  WIP      $(\"#transposh-fetch\").click(function() {\n//            //maintclick($(this));\n//            $.post(ajaxurl, {\n//                action: 'tp_fetch'\n//            });\n//            return false;\n//        });\n\n        // translate all button\n        do_translate_all = function () {\n            $(\"#progress_bar_all\").progressbar({\n                value:0\n            });\n            stop_translate_var = false;\n            // while there is a next\n            // get next post to translate\n            //var offset = \"0\";\n            $(\"#tr_loading\").data(\"done\",true);\n            $.ajaxSetup({\n                cache: false\n            });\n            $.ajax({\n                url: ajaxurl,\n                dataType: 'json',\n                data: {\n                    action: \"tp_translate_all\"\n                },\n                cache: false,\n                success: function (data) {\n                    dotimer = function(a) {\n                        $(\"#tr_allmsg\").text('');\n                        clearTimeout(timer2);\n                        //console.log(a);\n                        //console.log($(\"#tr_loading\").data(\"done\"));\n                        if ($(\"#tr_loading\").data(\"done\") || $(\"#tr_loading\").data(\"attempt\")>4) {\n                            $(\"#progress_bar_all\").progressbar('value' , (a+1)/data.length*100);\n                            $(\"#tr_loading\").data(\"attempt\",0);\n                            translate_post(data[a]);\n                            //console.log($(\"#tr_loading\").data(\"done\"));\n                            //console.log(\"done translate\" + a);\n                            // we call the next translation here...\n                            if (typeof data[a+1] !== 'undefined' && !stop_translate_var) {\n                                //console.log(\"trigger translation of \" +a);\n                                timer2 = setTimeout(function() {\n                                    dotimer(a+1)\n                                },2000);\n                                $(\"#tr_allmsg\").text('Waiting 2 seconds...');\n                            }\n                        } else {\n                            //console.log(\"waiting for translation to finish 60 seconds\");\n                            $(\"#tr_loading\").data(\"attempt\",$(\"#tr_loading\").data(\"attempt\")+1);\n                            timer2 = setTimeout(function() {\n                                dotimer(a)\n                            },15000);\n                            $(\"#tr_allmsg\").text('Translation incomplete - Waiting 15 seconds - attempt ' + $(\"#tr_loading\").data(\"attempt\") + '/5');\n                        }\n                    }\n                    timer2 = setTimeout(function() {\n                        dotimer(0)\n                    },0);\n                }\n            });\n            $(\"#transposh-translate\").text(\"Stop translate\")\n            $(\"#transposh-translate\").unbind('click').click(stop_translate);\n            return false;\n        }\n\n        stop_translate = function() {\n            clearTimeout(timer2);\n            stop_translate_var = true;\n            $(\"#transposh-translate\").text(\"Translate All Now\")\n            $(\"#transposh-translate\").unbind('click').click(do_translate_all);\n            return false;\n        }\n\n        $(\"#transposh-translate\").click(do_translate_all);       \n\n    });\n}(jQuery)); // end of closure"]}